# -*- coding: utf-8 -*-
"""
Created on Fri Nov 24 15:22:37 2017

@author: Collin
"""
#This code is written for python 3.6
#Packages that need to be installed or confirmed: Author used PIP Install
#BeuatifulSoup
#requests
# re (regular expressions)

#Specify Programs That you want to search for here. 
programlist = ['Windows 10', 'Adobe Acrobat', 'Microsoft Word', 'Kaspersky', 'Windows XP',
               'Ubuntu', 'Debian', 'Symantec', 'Google Chrome', 'Python', 'Java', 
               'Oracle', 'Cisco Wireless', 'Adobe Flash', 'Bitcoin Wallet', 'Steam',
               'Avast', 'Microsoft Edge', 'Microsoft Office', '7-zip']


#This Section Scrapes the Websites
from bs4 import BeautifulSoup
import requests
page = requests.get("https://www.darkreading.com/attacks-breaches.asp")
soup = BeautifulSoup(page.content, 'html.parser')
statements = soup.find_all("header", class_="strong medium")
url = "https://www.darkreading.com/attacks-breaches.asp"
titles = []
for element in range(0,len(statements)):
     sublist = []
     title = statements[element].a["title"]
     link = url + statements[element].a["href"]
     sublist.append(title)
     sublist.append(link)
     newlist = [title, link]
     titles.append(newlist)
url2 = "https://packetstormsecurity.com/news/tags/malware/"
page = requests.get(url2)
soup = BeautifulSoup(page.content, 'html.parser')
statements = soup.find_all("dl", class_="news")
titles1 = []
for element in range(0,len(statements)):
     sublist = []
     #title = statements[element].a["</a>"]
     link = statements[element].a["href"]
     #sublist.append(title)
     sublist.append(link)
     titles1.append(sublist)
title2 = []
for item in titles1:
    count = 0
    itemlettering = ""
    for listing in item:
        for letter in listing:
            if count > 16:
                itemlettering = itemlettering + letter
            count +=1
    title2.append(itemlettering)
title3 = []
for word in title2:
    string = ""
    for letter in word:
        if letter == "-":
            letter = " "
        string = string + letter
    title3.append(string)
title4 = []
for word in title3:
    word = word[:-5]
    newlist = [word, url2]
    titles.append(newlist)
url3 = "http://www.securityfocus.com/"
page = requests.get(url3)
soup = BeautifulSoup(page.content, 'html.parser')
statements = soup.find_all("span", class_="headline")
titlesec = []
for item in statements:
    count = 0
    itemlettering = ""
    for listing in item:
        for letter in listing:
            itemlettering = itemlettering + letter
            count +=1
    newlist = [itemlettering, url3]
    titles.append(newlist)
url4 = "https://www.us-cert.gov/ncas/current-activity"
page = requests.get(url4)
soup = BeautifulSoup(page.content, 'html.parser')
statements2 = soup.find_all("div", class_= "entry-description")
for element in range(0,len(statements2)):
    link = statements2[element].p
    link = str(link)
    link = link[3:]
    link = link[:-5]
    newlist = [link, url4]
    titles.append(newlist)
url5 = "https://www.rapid7.com/db/vulnerabilities"
page = requests.get(url5)
soup = BeautifulSoup(page.content, 'html.parser')
statement = soup.find_all("h4", class_="clearfix")
for element in range(0,len(statements)):
     sublist = []
     title = statement[element].a
     title = str(title)
     title = title[40:]
     title = title[:-4]
     word = ""
     count = 0
     for letter in title:
         if letter == ">":
             count = 1
         elif count == 1:
             word = word + letter
     newlist = [word, url5]
     titles.append(newlist)
# This Section Controls the Search Functionality by Way of Regular Expressions
import re
for match in programlist:
    for lists in titles:
        names = re.findall(r''+match, lists[0])
        if  names != []:
            print("Your Program:", match ,"came up in the following article: \n", lists[0], "\n at the URL:", lists[1])
  













#This Section Searches the programs But Currently Not a Good
#Processing Tool in Python to Convert your Programs to Searchable
#Terminology
#import os
#import fileinput
#def find_all(name, path):
#    result = []
#    for root, dirs, files in os.walk(path):
#        if name in files:
#            result.append(os.path.join(root, name))
#    return result
#
## Change the Second Value to Whatever Main Directory Your Python is in usually C:\\
#fileslisting = find_all('osscanresults.txt', 'E:\\')
#if fileslisting == []:
#    globevar = 1
#else:
#    programlist = []
#    filepath = fileslisting[0]
#    file = open(filepath, 'r+')
#    count = 0
#    for line in file:
#        if count < 1:
#            string = str(line)
#            globevar = int(string)
#        elif count > 0:
#            programlist.append(str(line.strip('\n')))
#        count +=1
#    with open(filepath, "r+") as f:
#        lines = f.readlines()
#    f.close()
#    lines[0] = "0 \n"
#    with open(filepath, "w+") as f:
#        f.writelines(lines)
#    f.close()
#    with open(filepath, "r") as f:
#        count = 0
#        for line in f:
#            if count <1:
#                string = str(line)
#                globevar = int(string)   
#                count += 1
#            else:
#                break
#    f.close()
#changedir = 0
#if globevar == 1 or changedir == 1:
#    mainfile = open('osscanresults.txt', 'w+')
#    count = 0
#    programlist = []
#    os.chdir('C:\\')
#    mainfile.write('1 \n')
#    for (dirname, dirs, files) in os.walk('.'):
#        for filename in files:
#            if filename.endswith('.exe'):
#                filename = str(filename)
#                filename = filename[:-4]
#                programlist.append(filename)
#                mainfile.write(filename)
#                mainfile.write('\n')
#    oslist = os.listdir()
#    mainfile.close()
#    print('ran')


